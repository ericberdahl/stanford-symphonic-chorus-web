{%- if include.piece.ref -%}
    {%- assign _piece_citation__piece = site.data.pieces[include.piece.ref] -%}
{%- else -%}
    {%- assign _piece_citation__piece = include.piece -%}
{%- endif -%}
{%- if _piece_citation__piece.citation -%}
    {%- assign _piece_citation__citation = _piece_citation__piece.citation -%}
{%- else -%}
    {%- assign _piece_citation__citation = _piece_citation__piece.title | prepend: "<em>"
                                                       | append: "</em>" -%}
{%- endif -%}
{%- case include.style | default: "em-tagged" -%}
    {%- when "em-tagged" -%}
        {%- assign _piece_citation__composer = _piece_citation__piece.composer -%}
    {%- when "plain" -%}
        {%- assign _piece_citation__composer = _piece_citation__piece.composer | append: ":" -%}
        {%- assign _piece_citation__citation = _piece_citation__citation | strip_html -%}
    {%- when "title-only" -%}
        {%- assign _piece_citation__composer = nil -%}
{%- endcase -%}
{{ site.data.utils.empty_array | unshift: include.piece.suffix
                               | unshift: _piece_citation__citation
                               | unshift: include.piece.prefix
                               | unshift: _piece_citation__composer
                               | compact
                               | join: " " }}